trigger:
  branches:
    include:
    - refs/heads/master
variables:
  CYPRESS_BASEURL: 'http://192.168.122.191:7585'
  CYPRESS_USERNAME: 'haris'
  CYPRESS_PASSWORD: 'Ab123'
jobs:
- job: TP10_Automation
  displayName: TP10 Automated Sanity Testing
  pool:
    name: Default
  steps:
  - checkout: self
    clean: true
    fetchTags: false
  - task: PowerShell@2
    displayName: Set Environment Variables
    inputs:
      targetType: 'inline'
      script: |
        $env:CYPRESS_BASEURL = "$(CYPRESS_BASEURL)"
        $env:CYPRESS_USERNAME = "$(CYPRESS_USERNAME)"
        $env:CYPRESS_PASSWORD = "$(CYPRESS_PASSWORD)"
  - task: PowerShell@2
    displayName: Print Environment Variables
    inputs:
      targetType: 'inline'
      script: |
        Get-ChildItem Env:
        $env:CYPRESS_USERNAME = "$(CYPRESS_USERNAME)"
        $env:CYPRESS_PASSWORD = "$(CYPRESS_PASSWORD)"
        $env:CYPRESS_BASEURL = "$(CYPRESS_BASEURL)"
  - task: Npm@1
    displayName: Install Packages and dependencies
    inputs:
      verbose: false
  - task: Npm@1
    displayName: Run e2e Sanity Tests
    inputs:
      command: custom
      verbose: false
      customCommand: run e2e
  - task: PublishTestResults@2
    displayName: 'Publish Test Results'
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: '**/my-test-output-*.xml'
      searchFolder: '$(System.DefaultWorkingDirectory)/results'